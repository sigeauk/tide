# ============================================
# TIDE Environment Configuration
# ============================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control
# ============================================

# --- APPLICATION SETTINGS ---
TIDE_VERSION=2.2.0
APP_URL=https://tide:8501
SYNC_INTERVAL_MINUTES=60

# --- AUTHENTICATION ---
# Set to 'true' to disable Keycloak and run without login
AUTH_DISABLED=false

# Keycloak OIDC (required if AUTH_DISABLED=false)
# KEYCLOAK_URL        : The URL users see in their browser (external)
# KEYCLOAK_INTERNAL_URL: The URL the tide-app container uses to reach
#                        Keycloak over the Docker network or host.
#                        If Keycloak is on the same host, use the hostname.
KEYCLOAK_URL=https://keycloak.yourdomain.local:8443
KEYCLOAK_INTERNAL_URL=https://keycloak.yourdomain.local:8443
KEYCLOAK_REALM=tide
KEYCLOAK_CLIENT_ID=tide-app
KEYCLOAK_CLIENT_SECRET=<your-client-secret>

# --- ELASTIC SECURITY (Required) ---
# Kibana URL for rule management
ELASTIC_URL=https://kibana.yourdomain.local:5601
# Elasticsearch URL for direct queries
ELASTICSEARCH_URL=https://elasticsearch.yourdomain.local:9200
# API Key with detection rules read/write permissions
ELASTIC_API_KEY=<your-elastic-api-key>
# Comma-separated Kibana spaces to sync
KIBANA_SPACES=production,staging

# --- OPENCTI (Optional) ---
# Threat intelligence platform integration
OPENCTI_URL=https://opencti.yourdomain.local:8080
OPENCTI_TOKEN=<your-opencti-token>

# --- GITLAB (Optional) ---
# For report dispatching to internal GitLab
GITLAB_URL=https://gitlab.yourdomain.local/
GITLAB_TOKEN=<your-gitlab-token>

# --- MITRE ATT&CK DATA SOURCES ---
# For air-gapped: host these files on internal server
MITRE_SOURCE=https://raw.githubusercontent.com/mitre/cti/master/enterprise-attack/enterprise-attack.json
MITRE_MOBILE_SOURCE=https://raw.githubusercontent.com/mitre/cti/master/mobile-attack/mobile-attack.json
MITRE_ICS_SOURCE=https://raw.githubusercontent.com/mitre/cti/master/ics-attack/ics-attack.json
MITRE_PRE_SOURCE=https://raw.githubusercontent.com/mitre/cti/master/pre-attack/pre-attack.json

# --- SIGMA RULES ---
# GitHub URL for Sigma rule repository
SIGMA_REPO_URL=https://github.com/SigmaHQ/sigma.git

# Elastic detection rules repository
ELASTIC_REPO_URL=https://github.com/elastic/detection-rules.git

# --- SSL/TLS ---
# SSL_VERIFY: Whether Python verifies TLS certificates for outbound
#   HTTPS calls to Keycloak, Elastic, OpenCTI, etc.
#   'true'  = verify using CA_CERT_PATH or the auto-merged ca-bundle.crt
#   'false' = skip verification entirely (less secure, but gets you running)
SSL_VERIFY=true

# CA_CERT_PATH: (Optional) Explicit path to a CA cert INSIDE the container.
#   Only needed if you have a single CA file and don't want the auto-merge.
#   The docker-compose entrypoint automatically merges all .crt files
#   mounted into /app/certs/ into /app/certs/ca-bundle.crt, so normally
#   you do NOT need to set this.
# CA_CERT_PATH=/app/certs/ca-bundle.crt

# ── How CA trust works ──
# 1. Mount your host CA certs into /app/certs/ in docker-compose.yml
#    (e.g. /etc/ipa/ca.crt -> /app/certs/ipa-ca.crt)
# 2. The entrypoint auto-creates /app/certs/ca-bundle.crt from all .crt files
# 3. REQUESTS_CA_BUNDLE and SSL_CERT_FILE env vars (set in docker-compose)
#    point to that bundle so requests, httpx, and urllib all trust it
# 4. No 'update-ca-certificates' or root access needed

# ── Nginx TLS (for the TIDE web UI at https://tide:8501) ──
# Mount your server cert and key in docker-compose.yml volumes.
# Nginx expects them at /etc/nginx/certs/server.crt and server.key.
# See docker-compose.yml comments for examples.

# --- DATABASE ---
# DuckDB path (relative to /app in container)
DUCKDB_PATH=data/tide.duckdb

# --- LOGGING ---
LOG_LEVEL=INFO
RULE_LOG_PATH=C:\ProgramData\tide\log\rules
# LOG_FORMAT=json
