{% from "macros/icons.html" import icon, icon_text %}
<!-- Promotion Metrics Row Partial - swappable via HTMX -->

{# ── 1. Staging Rules ── #}
<div class="metric-card">
    <p class="metric-value">{{ metrics.staging_total }}</p>
    <p class="metric-label">Staging Rules</p>
    <p class="metric-sub">{{ metrics.production_total }} in production</p>
</div>

{# ── 2. Enabled ── #}
<div class="metric-card">
    <p class="metric-value success">{{ metrics.staging_enabled }}</p>
    <p class="metric-label">Enabled</p>
    <p class="metric-sub">{{ metrics.staging_total - metrics.staging_enabled }} disabled</p>
</div>

{# ── 3. Validated ── #}
<div class="metric-card">
    <p class="metric-value {% if metrics.staging_validated >= metrics.staging_total * 0.8 %}success{% elif metrics.staging_validated >= metrics.staging_total * 0.5 %}warning{% else %}danger{% endif %}">
        {{ metrics.staging_validated }}
    </p>
    <p class="metric-label">Validated</p>
    <p class="metric-sub">
        <span class="text-warning">{{ metrics.staging_validation_expired }} expired</span> · {{ metrics.staging_never_validated }} never
    </p>
</div>

{# ── 4. Quality (bracket breakdown) ── #}
<div class="metric-card">
    <p class="metric-value">{{ metrics.staging_avg_score | round(1) }}</p>
    <p class="metric-label">Avg Quality</p>
    <p class="metric-sub">
        <span class="text-success">H:{{ metrics.staging_quality_excellent }} </span>
        <span class="text-info">M:{{ metrics.staging_quality_good }} </span>
        <span class="text-sev-medium">L:{{ metrics.staging_quality_fair }} </span>
        <span class="text-danger">C:{{ metrics.staging_quality_poor }} </span>
    </p>
</div>

{# ── 5. Severity ── #}
<div class="metric-card">
    {% set sev = metrics.staging_severity %}
    <p class="metric-value">{{ metrics.staging_total }}</p>
    <p class="metric-label">Severity</p>
    <p class="metric-sub">
        {% if sev.get('critical', 0) > 0 %}<span class="text-danger">C:{{ sev.get('critical', 0) }}</span> {% endif %}
        {% if sev.get('high', 0) > 0 %}<span class="text-warning">H:{{ sev.get('high', 0) }}</span> {% endif %}
        {% if sev.get('medium', 0) > 0 %}<span class="text-sev-medium">M:{{ sev.get('medium', 0) }}</span> {% endif %}
        {% if sev.get('low', 0) > 0 %}<span class="text-success">L:{{ sev.get('low', 0) }}</span>{% endif %}
    </p>
</div>

{# ── 6. Last Synced ── #}
<div class="metric-card">
    <p class="metric-value" style="font-size: 1.1rem;">
        {{ icon('refresh-cw', '24') }}
    </p>
    <p class="metric-label">Last Synced</p>
    <p class="metric-sub">{{ last_sync_time | default('Never') }}</p>
</div>