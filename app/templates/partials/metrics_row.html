{% from "macros/icons.html" import icon, icon_text %}
<!-- Metrics Row Partial - swappable via HTMX -->

{# ── 1. Total Rules ── #}
<div class="metric-card">
    <p class="metric-value">{{ metrics.total_rules }}</p>
    <p class="metric-label">Total Rules</p>
    <p class="metric-sub">
        {% set spaces = metrics.rules_by_space.items() | list %}
        {% if spaces %}
            {% for name, count in spaces[:3] %}{{ name | capitalize }}: {{ count }}{% if not loop.last %} · {% endif %}{% endfor %}
        {% else %}
            No spaces
        {% endif %}
    </p>
</div>

{# ── 2. Enabled ── #}
<div class="metric-card">
    <p class="metric-value success">{{ metrics.enabled_rules }}</p>
    <p class="metric-label">Enabled</p>
    <p class="metric-sub">{{ metrics.disabled_rules }} disabled</p>
</div>

{# ── 3. Validated ── #}
<div class="metric-card">
    <p class="metric-value {% if metrics.validated_count >= metrics.total_rules * 0.8 %}success{% elif metrics.validated_count >= metrics.total_rules * 0.5 %}warning{% else %}danger{% endif %}">
        {{ metrics.validated_count }}
    </p>
    <p class="metric-label">Validated</p>
    <p class="metric-sub">
        <span class="text-warning">{{ metrics.validation_expired_count }} expired</span> · {{ metrics.never_validated_count }} never
    </p>
</div>

{# ── 4. Quality (bracket breakdown) ── #}
<div class="metric-card">
    <p class="metric-value">{{ metrics.avg_score }}</p>
    <p class="metric-label">Avg Quality</p>
    <p class="metric-sub">
        <span class="text-success">H:{{ metrics.quality_excellent }} </span>
        <span class="text-info">M:{{ metrics.quality_good }} </span>
        <span class="text-sev-medium">L:{{ metrics.quality_fair }} </span>
        <span class="text-danger">C:{{ metrics.quality_poor }} </span>
    </p>
</div>

{# ── 5. Severity ── #}
<div class="metric-card">
    {% set sev = metrics.severity_breakdown %}
    <p class="metric-value">{{ metrics.total_rules }}</p>
    <p class="metric-label">Severity</p>
    <p class="metric-sub">
        {% if sev.get('critical', 0) > 0 %}<span class="text-danger">C:{{ sev.get('critical', 0) }}</span> {% endif %}
        {% if sev.get('high', 0) > 0 %}<span class="text-warning">H:{{ sev.get('high', 0) }}</span> {% endif %}
        {% if sev.get('medium', 0) > 0 %}<span class="text-sev-medium">M:{{ sev.get('medium', 0) }}</span> {% endif %}
        {% if sev.get('low', 0) > 0 %}<span class="text-success">L:{{ sev.get('low', 0) }}</span>{% endif %}
    </p>
</div>

{# ── 6. Last Synced ── #}
<div class="metric-card">
    <p class="metric-value" style="font-size: 1.1rem;">
        {{ icon('refresh-cw', '24') }}
    </p>
    <p class="metric-label">Last Synced</p>
    <p class="metric-sub">{{ last_sync_time | default('Never') }}</p>
</div>
