/* ================================================================
 * TIDE  —  Semantic Design System
 *
 * Migrated from Tailwind CSS v4 / OKLCH to hand-crafted hex.
 * Palette derived from the web-repo reference (GitHub-dark aesthetic).
 *
 * Architecture
 *   Brand:     --color-primary / --color-secondary
 *   5 Layers:  bg-base → bg-layer-5  (Distance-to-User elevation)
 *   5 Sevs:    sev-1 (critical) → sev-5 (info)
 *   Semantic:  success / warning / danger / info
 * ================================================================ */

/* ── ROOT VARIABLES ──────────────────────────────────────────── */
:root {
  /* ── Brand ──────────────────────────────── */
  --color-primary:        #58a6ff;
  --color-primary-hover:  #79c0ff;
  --color-primary-muted:  #1a3a5c;

  --color-secondary:      #f0883e;
  --color-secondary-hover:#fbaf5d;

  /* ── 5-Layer Elevation  (darker = further away) ── */
  /* Layer 1 – bg-base : deepest app background */
  --color-bg-base:        #0d1117;
  --color-bg-base-alt:    #111922;

  /* Layer 2 – bg-surface : sidebar, cards */
  --color-bg-surface:     #161b22;
  --color-bg-surface-hover:#1c2128;

  /* Layer 3 – bg-action : buttons, inputs */
  --color-bg-action:      #1c2128;
  --color-bg-action-hover:#21262d;

  /* Layer 4 – active overlays */
  --color-bg-layer-4:     #21262d;
  --color-bg-layer-4-hover:#282e36;

  /* Layer 5 – tooltips, modals – lightest */
  --color-bg-layer-5:     #282e36;
  --color-bg-layer-5-hover:#2d333b;

  /* ── Depth highlights (simulated top-edge light) ── */
  --color-highlight-1:    #2d333b;
  --color-highlight-2:    #3b434d;
  --color-highlight-3:    #4a5260;

  /* ── Typography ─────────────────────────── */
  --ff: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";

  --color-text:           #c9d1d9;
  --color-text-secondary: #b1bac4;
  --color-text-muted:     #8b949e;

  --h1: 700 1.5rem/1.2 var(--ff);
  --h2: 700 1.25rem/1.2 var(--ff);
  --h3: 600 1.125rem/1.4 var(--ff);
  --h4: 600 1rem/1.5 var(--ff);
  --p:  400 0.875rem/1.6 var(--ff);
  --small: 400 0.75rem/1.6 var(--ff);

  /* ── Borders ────────────────────────────── */
  --color-border:         #30363d;
  --color-border-muted:   #21262d;
  --color-border-strong:  #3b434d;
  --border-card: solid 1px var(--color-border-muted);

  /* ── Shadows ────────────────────────────── */
  --shadow-sm:    0 1px 2px rgba(0,0,0,0.20);
  --shadow:       0 2px 4px rgba(0,0,0,0.25), 0 4px 8px rgba(0,0,0,0.15);
  --shadow-lg:    0 4px 8px rgba(0,0,0,0.30), 0 12px 24px rgba(0,0,0,0.20);
  --shadow-modal: 0 8px 16px rgba(0,0,0,0.35), 0 24px 48px rgba(0,0,0,0.25);
  --color-overlay:rgba(0,0,0,0.75);

  /* ── Gradients ──────────────────────────── */
  --gradient:       linear-gradient(180deg, var(--color-bg-surface-hover) 0%, var(--color-bg-surface) 100%);
  --gradient-hover: linear-gradient(180deg, var(--color-bg-action) 0%, var(--color-bg-surface-hover) 100%);

  /* ── 5-Severity System ──────────────────── */
  /* Sev-1 Critical (Red) */
  --color-sev-1:      #f85149;
  --color-sev-1-bg:   #3d1f1f;
  --color-sev-1-text: #ffa198;
  --color-sev-1-glow: rgba(248,81,73,0.18);

  /* Sev-2 High (Amber) */
  --color-sev-2:      #d29922;
  --color-sev-2-bg:   #3d2e00;
  --color-sev-2-text: #e3b341;
  --color-sev-2-glow: rgba(210,153,34,0.18);

  /* Sev-3 Medium (Blue) */
  --color-sev-3:      #58a6ff;
  --color-sev-3-bg:   #1a2332;
  --color-sev-3-text: #79c0ff;
  --color-sev-3-glow: rgba(88,166,255,0.18);

  /* Sev-4 Low / Success (Green) */
  --color-sev-4:      #3fb950;
  --color-sev-4-bg:   #1a3224;
  --color-sev-4-text: #7ee787;
  --color-sev-4-glow: rgba(63,185,80,0.18);

  /* Sev-5 Informational (Purple) */
  --color-sev-5:      #bc8cff;
  --color-sev-5-bg:   #271e37;
  --color-sev-5-text: #d2a8ff;
  --color-sev-5-glow: rgba(188,140,255,0.18);

  /* ── Semantic aliases ───────────────────── */
  --color-danger:       var(--color-sev-1);
  --color-danger-bg:    var(--color-sev-1-bg);
  --color-danger-text:  var(--color-sev-1-text);
  --color-danger-glow:  var(--color-sev-1-glow);

  --color-warning:      var(--color-sev-2);
  --color-warning-bg:   var(--color-sev-2-bg);
  --color-warning-text: var(--color-sev-2-text);
  --color-warning-glow: var(--color-sev-2-glow);

  --color-info:         var(--color-sev-3);
  --color-info-bg:      var(--color-sev-3-bg);
  --color-info-text:    var(--color-sev-3-text);
  --color-info-glow:    var(--color-sev-3-glow);

  --color-success:      var(--color-sev-4);
  --color-success-bg:   var(--color-sev-4-bg);
  --color-success-text: var(--color-sev-4-text);
  --color-success-glow: var(--color-sev-4-glow);

  /* ── MITRE pill status colors ──────────── */
  --color-covered:      var(--color-success);
  --color-covered-bg:   var(--color-success-bg);
  --color-covered-glow: var(--color-success-glow);

  --color-gap:          var(--color-danger);
  --color-gap-bg:       var(--color-danger-bg);
  --color-gap-glow:     var(--color-danger-glow);

  --color-defense:      var(--color-info);
  --color-defense-bg:   var(--color-info-bg);
  --color-defense-glow: var(--color-info-glow);

  /* ── Layout ─────────────────────────────── */
  --sidebar-width-collapsed: 60px;
  --sidebar-width-expanded:  240px;
  --header-height: 56px;

  /* ── Transitions ────────────────────────── */
  --transition-fast:   150ms ease;
  --transition-normal: 250ms ease;
  --transition-slow:   400ms ease;

  /* ── Radii ──────────────────────────────── */
  --radius-sm:   4px;
  --radius-md:   8px;
  --radius-lg:   12px;
  --radius-xl:   16px;
  --radius-full: 9999px;
}


/* ================================================================
 * BASE STYLES
 * ================================================================ */
html {
  color-scheme: dark;
  font-size: 14px;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  background-color: var(--color-bg-base);
  color: var(--color-text-secondary);
  font: var(--p);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

h1 { font: var(--h1); color: var(--color-text); }
h2 { font: var(--h2); color: var(--color-text); margin-bottom: 0.5rem; }
h3 { font: var(--h3); color: var(--color-text); margin-bottom: 0.5rem; }
h4 { font: var(--h4); color: var(--color-text); margin-bottom: 0.5rem; }
p  { font: var(--p);  color: var(--color-text-secondary); }
small, .small { font: var(--small); color: var(--color-text-muted); }

a {
  text-decoration: none;
  color: var(--color-text);
  transition: color var(--transition-fast);
}
a:hover { color: var(--color-primary); }


/* ================================================================
 * PILL SYSTEM
 * ================================================================ */

/* Base pill */
.pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
  font-size: 0.7rem;
  font-weight: 600;
  padding: 0.2rem 0.6rem;
  border-radius: var(--radius-md);
  white-space: nowrap;
  transition: all var(--transition-fast);
}

/* Status Pills (enabled/disabled) */
.status-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  font-size: 0.7rem;
  font-weight: 500;
  padding: 0.2rem 0.6rem;
  min-height: 22px;
  border-radius: var(--radius-md);
  background-color: var(--color-bg-action);
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
  box-sizing: border-box;
}

.status-pill.status-enabled {
  background: var(--color-success-glow);
  color: var(--color-success-text);
  border-color: var(--color-success);
  box-shadow: 0 0 8px var(--color-success-glow);
}

.status-pill.status-disabled {
  background: var(--color-bg-base);
  color: var(--color-text-muted);
  border-color: var(--color-border);
}

.status-dot {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.75rem;
  font-weight: 500;
  white-space: nowrap;
  flex-shrink: 0;
  max-width: 120px;
  overflow: hidden;
  text-overflow: ellipsis;
}

.status-dot::before {
  content: '';
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

/* Severity Pills — mapped to 5-sev system */
.sev-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 700;
  padding: 0.2rem 0.6rem;
  min-height: 22px;
  border-radius: var(--radius-md);
  text-transform: uppercase;
  letter-spacing: 0.02em;
  border: 1px solid rgba(0,0,0,0.15);
  box-sizing: border-box;
}

.sev-pill.sev-critical {
  background: var(--color-sev-1-glow);
  color: var(--color-sev-1-text);
  box-shadow: 0 0 12px var(--color-sev-1-glow);
}

.sev-pill.sev-high {
  background: var(--color-sev-2-glow);
  color: var(--color-sev-2-text);
  box-shadow: 0 0 12px var(--color-sev-2-glow);
}

.sev-pill.sev-medium {
  background: var(--color-sev-3-glow);
  color: var(--color-sev-3-text);
  box-shadow: 0 0 12px var(--color-sev-3-glow);
}

.sev-pill.sev-low {
  background: var(--color-sev-4-glow);
  color: var(--color-sev-4-text);
  box-shadow: 0 0 12px var(--color-sev-4-glow);
}

.sev-pill.sev-informational {
  background: var(--color-sev-5-glow);
  color: var(--color-sev-5-text);
  box-shadow: 0 0 12px var(--color-sev-5-glow);
}

/* Legacy severity attr selectors (backward compat) */
.sev-pill[class*="critical"] { background: var(--color-sev-1-glow); color: var(--color-sev-1-text); }
.sev-pill[class*="high"]     { background: var(--color-sev-2-glow); color: var(--color-sev-2-text); }
.sev-pill[class*="medium"]   { background: var(--color-sev-3-glow); color: var(--color-sev-3-text); }
.sev-pill[class*="low"]      { background: var(--color-sev-4-glow); color: var(--color-sev-4-text); }


/* ================================================================
 * MITRE PILLS
 * ================================================================ */
.mitre-pills-wrap {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
  align-items: center;
}

.mitre-pill {
  font-family: "SF Mono", "Fira Code", Consolas, monospace;
  font-weight: 500;
  border-radius: var(--radius-md);
  white-space: nowrap;
  display: inline-flex;
  align-items: center;
  gap: 0.15rem;
  transition: all var(--transition-fast);
  background: var(--color-primary-muted);
  color: var(--color-primary);
  cursor: pointer;
}

.mitre-pill.mitre-sm { font-size: 0.625rem; padding: 0.15rem 0.4rem; }
.mitre-pill.mitre-md { font-size: 0.7rem;   padding: 0.2rem 0.5rem;  }
.mitre-pill.mitre-lg { font-size: 0.8rem;   padding: 0.25rem 0.6rem; }

.mitre-rule-count {
  font-size: 0.55rem;
  opacity: 0.8;
  font-weight: 600;
}

/* Status: Covered (green glow) */
.mitre-pill.mitre-covered,
.mitre-pill.status-covered {
  background: var(--color-covered-glow);
  color: var(--color-success-text);
  border: 1px solid var(--color-success);
  box-shadow: 0 0 8px var(--color-covered-glow);
}
.mitre-pill.mitre-covered:hover,
.mitre-pill.status-covered:hover {
  box-shadow: 0 0 12px var(--color-covered-glow);
  transform: scale(1.02);
}

/* Status: Gap (red glow) */
.mitre-pill.mitre-gap,
.mitre-pill.status-gap,
.mitre-pill.mitre-not-covered {
  background: var(--color-gap-glow);
  color: var(--color-danger-text);
  border: 1px solid var(--color-danger);
  box-shadow: 0 0 8px var(--color-gap-glow);
}
.mitre-pill.mitre-gap:hover,
.mitre-pill.status-gap:hover {
  box-shadow: 0 0 12px var(--color-gap-glow);
  transform: scale(1.02);
}

/* Status: Defense (blue glow) */
.mitre-pill.mitre-defense,
.mitre-pill.status-defense {
  background: var(--color-defense-glow);
  color: var(--color-info-text);
  border: 1px solid var(--color-info);
  box-shadow: 0 0 8px var(--color-defense-glow);
}
.mitre-pill.mitre-defense:hover,
.mitre-pill.status-defense:hover {
  box-shadow: 0 0 12px var(--color-defense-glow);
  transform: scale(1.02);
}

/* Status: Neutral */
.mitre-pill.mitre-neutral {
  background: var(--color-primary-muted);
  color: var(--color-primary);
  border: 1px solid transparent;
}
.mitre-pill.mitre-neutral:hover {
  background: var(--color-primary);
  color: var(--color-bg-base);
}

/* Overflow & empty */
.mitre-pill.mitre-more {
  background: var(--color-bg-action);
  color: var(--color-text-muted);
  border: 1px solid var(--color-border-muted);
  box-shadow: none;
}

.mitre-pill.mitre-none {
  background: var(--color-bg-base);
  color: var(--color-text-muted);
  font-style: italic;
  border: 1px solid var(--color-border-muted);
  box-shadow: none;
}


/* ================================================================
 * APP LAYOUT
 * ================================================================ */
.app-layout {
  display: flex;
  min-height: 100vh;
  width: 100%;
}

.main-content {
  flex: 1;
  min-width: 0;
  margin-left: var(--sidebar-width-collapsed);
  padding: 1.5rem 2rem;
  min-height: 100vh;
  overflow-x: hidden;
  background-color: var(--color-bg-base);
  transition: margin-left var(--transition-normal);
}

.app-layout:has(.sidebar.expanded) .main-content {
  margin-left: var(--sidebar-width-expanded);
}


/* ================================================================
 * SIDEBAR  (Layer 2 — bg-surface)
 * ================================================================ */
.sidebar {
  background: var(--color-bg-surface);
  border-right: var(--border-card);
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  width: var(--sidebar-width-collapsed);
  overflow: visible;
  transition: width var(--transition-normal);
  z-index: 50;
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow);
}

.sidebar.expanded { width: var(--sidebar-width-expanded); }

.sidebar-header {
  padding: 1rem;
  border-bottom: var(--border-card);
  display: flex;
  align-items: center;
  gap: 0.75rem;
  min-height: var(--header-height);
}

.sidebar-logo { width: 32px; height: 32px; flex-shrink: 0; }

.sidebar-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
  white-space: nowrap;
  opacity: 0;
  transition: opacity var(--transition-normal);
}

.sidebar.expanded .sidebar-title { opacity: 1; }

.sidebar-nav {
  flex: 1;
  padding: 0.5rem;
  overflow: visible;
  position: relative;
}

.sidebar.expanded .sidebar-nav {
  overflow-y: auto;
  overflow-x: hidden;
}

.sidebar:not(.expanded) .nav-item {
  position: relative;
  overflow: visible;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-radius: var(--radius-md);
  color: var(--color-primary);
  opacity: 0.6;
  text-decoration: none;
  transition: all var(--transition-fast);
  margin-bottom: 0.25rem;
  position: relative;
  cursor: pointer;
  border: none;
  background: transparent;
  width: 100%;
  text-align: left;
  font: inherit;
}

.nav-item:hover {
  background-color: var(--color-bg-surface-hover);
  opacity: 1;
}

.nav-item.active {
  background-color: var(--color-primary-muted);
  color: var(--color-primary);
  opacity: 1;
}

.nav-icon {
  width: 24px;
  height: 24px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  color: currentColor;
}

.nav-icon-img {
  width: 22px;
  height: 22px;
  flex-shrink: 0;
  object-fit: contain;
  opacity: 0.7;
}

.nav-item:hover .nav-icon-img,
.nav-item.active .nav-icon-img { opacity: 1; }

.nav-icon-svg {
  width: 22px;
  height: 22px;
  flex-shrink: 0;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
  stroke-linecap: round;
  stroke-linejoin: round;
  transition: opacity var(--transition-fast);
}

.nav-item:hover .nav-icon-svg,
.nav-item.active .nav-icon-svg { stroke: var(--color-primary); }

.nav-label {
  white-space: nowrap;
  opacity: 0;
  transition: opacity var(--transition-normal);
  pointer-events: none;
}

.sidebar.expanded .nav-label { opacity: 1; }

/* Sidebar tooltips (Layer 5) */
.sidebar:not(.expanded) .nav-item[data-tooltip]::after {
  content: attr(data-tooltip) !important;
  position: absolute !important;
  left: calc(100% + 10px) !important;
  top: 50% !important;
  bottom: auto !important;
  transform: translateY(-50%) !important;
  background: var(--color-bg-layer-5) !important;
  border: 1px solid var(--color-border) !important;
  border-top: 1px solid var(--color-highlight-3) !important;
  color: var(--color-text) !important;
  padding: 0.5rem 0.75rem !important;
  border-radius: var(--radius-md) !important;
  font-size: 0.875rem !important;
  white-space: nowrap !important;
  opacity: 0 !important;
  visibility: hidden !important;
  transition: all var(--transition-fast) !important;
  z-index: 9999 !important;
  box-shadow: var(--shadow-lg) !important;
  pointer-events: none !important;
}

.sidebar .nav-item[data-tooltip]::before {
  display: none !important;
  content: none !important;
}

.sidebar:not(.expanded) .nav-item[data-tooltip]:hover::after {
  opacity: 1 !important;
  visibility: visible !important;
  transform: translateY(-50%) !important;
}

.sidebar-footer {
  padding: 0.5rem;
  border-top: var(--border-card);
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.sidebar-footer .nav-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  border-radius: var(--radius-md);
}

.theme-toggle,
.sidebar-toggle {
  border: none;
  background: transparent;
}

.toggle-icon,
.theme-icon { font-size: 1.125rem; }

.user-avatar {
  width: 24px;
  height: 24px;
  border-radius: var(--radius-full);
  background: var(--color-primary-muted);
  color: var(--color-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  font-weight: 600;
  flex-shrink: 0;
}

.user-info { cursor: default; }

/* ── Sidebar: Toggle-only expansion (disable hover expand) ── */
.sidebar { width: var(--sidebar-width-collapsed) !important; }
.sidebar:hover { width: var(--sidebar-width-collapsed) !important; }
.sidebar:hover .sidebar-title,
.sidebar:hover .nav-label { opacity: 0 !important; }
.app-layout:has(.sidebar:hover) .main-content { margin-left: var(--sidebar-width-collapsed) !important; }

.sidebar.expanded { width: var(--sidebar-width-expanded) !important; }
.sidebar.expanded .sidebar-title,
.sidebar.expanded .nav-label { opacity: 1 !important; }
.app-layout:has(.sidebar.expanded) .main-content { margin-left: var(--sidebar-width-expanded) !important; }


/* ================================================================
 * METRIC CARDS  (Layer 2 — bg-surface, default)
 * ================================================================ */
.metric-card {
  background: var(--color-bg-surface);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  padding: 1.25rem;
  text-align: center;
  transition: all var(--transition-fast);
  box-shadow: var(--shadow);
}

/* Nested metric-cards: promote to Layer 3 so they're lighter than parent */
.overview-section .metric-card {
  background: var(--color-bg-action);
  border: none;
  border-top: 1px solid var(--color-highlight-2);
  box-shadow: var(--shadow-sm);
}

.metric-value {
  font: var(--h1);
  color: var(--color-text);
  margin-bottom: 0.25rem;
}

.metric-value.success { color: var(--color-success); }
.metric-value.warning { color: var(--color-warning); }
.metric-value.danger  { color: var(--color-danger); }

.metric-label {
  font: var(--small);
  color: var(--color-text-secondary);
  margin-bottom: 0.25rem;
}

.metric-sub {
  font: var(--small);
  color: var(--color-text-muted);
}


/* ================================================================
 * RULE CARDS  (Layer 2 — bg-surface)
 * ================================================================ */
.rule-card {
  background: var(--color-bg-surface);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  padding: 1rem;
  display: flex;
  flex-direction: column;
  transition: all var(--transition-fast);
  height: 275px;
  overflow: hidden;
  box-shadow: var(--shadow);
}

.rule-card:hover {
  background: var(--color-bg-surface-hover);
  border-color: var(--color-border-strong);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.rule-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 0.5rem;
  flex-shrink: 0;
}

.rule-name {
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--color-text);
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  line-clamp: 3;
  -webkit-box-orient: vertical;
  flex: 1;
  min-width: 0;
}

.rule-pills-stack {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 0.35rem;
  flex-shrink: 0;
}

.rule-pills-stack .status-pill,
.rule-pills-stack .sev-pill {
  font-size: 0.65rem;
  padding: 0.15rem 0.5rem;
}

.rule-pills-stack .mitre-pills-wrap { justify-content: flex-end; }

.mitre-pills-row {
  display: flex;
  justify-content: flex-end;
  gap: 0.25rem;
  flex-wrap: wrap;
}

.mitre-pills-row .mitre-pill {
  font-size: 0.6rem;
  padding: 0.15rem 0.35rem;
}

.rule-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  gap: 0.4rem;
  overflow: hidden;
  min-height: 0;
}

.rule-footer {
  display: flex;
  gap: 0.5rem;
  padding-top: 0.5rem;
  border-top: 1px solid var(--color-border);
  flex-shrink: 0;
}

.rule-footer .btn { flex: 1; }

.pill-stack {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  flex-shrink: 0;
}

.sev-pill {
  font-size: 0.7rem;
  font-weight: 600;
  padding: 0.2rem 0.6rem;
  border-radius: var(--radius-md);
  text-transform: uppercase;
}

.mitre-row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
}

.mitre-pill {
  font-size: 0.7rem;
  padding: 0.2rem 0.5rem;
  border-radius: var(--radius-md);
  background-color: var(--color-primary-muted);
  color: var(--color-primary);
}

.mitre-more {
  background-color: var(--color-bg-action);
  color: var(--color-text-muted);
}

.mitre-none {
  background-color: var(--color-bg-base);
  color: var(--color-text-muted);
  font-style: italic;
}

.score-section { flex-shrink: 0; }

.score-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.75rem;
  margin-bottom: 0.35rem;
  color: var(--color-text-muted);
}

.score-value { font-weight: 600; }

.score-track {
  height: 5px;
  background-color: var(--color-bg-base);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.score-fill {
  height: 100%;
  border-radius: var(--radius-full);
  transition: width var(--transition-normal);
}

.meta-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.15rem 1rem;
  font-size: 0.7rem;
  color: var(--color-text-muted);
  padding-top: 0.35rem;
  border-top: 1px solid var(--color-border-muted);
  flex-shrink: 0;
}

.meta-left,
.meta-right {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
  min-width: 0;
}

.meta-row,
.meta-item {
  display: flex;
  gap: 0.35rem;
  align-items: baseline;
}
.meta-label { color: var(--color-text-muted); white-space: nowrap; text-transform: uppercase; font-size: 0.65rem; }

.meta-val { color: var(--color-text-secondary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; min-width: 0; }


/* ================================================================
 * PROMOTION CARDS
 * ================================================================ */
.promotion-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.promo-card {
  background: var(--color-bg-surface);
  border: 1px solid var(--color-border);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  padding: 1rem 1.25rem;
  transition: all var(--transition-fast);
  box-shadow: var(--shadow);
}

.promo-card:hover {
  border-color: var(--color-primary);
  box-shadow: var(--shadow-lg);
}

.promo-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1rem;
  margin-bottom: 1rem;
  flex-wrap: wrap;
}

.promo-name {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-primary);
  flex: 1;
  min-width: 200px;
}

.promo-pills {
  display: flex;
  flex-wrap: wrap;
  gap: 0.375rem;
  align-items: center;
}

.promo-body {
  display: grid;
  grid-template-columns: 1fr 1fr auto;
  gap: 1rem;
  padding: 1rem 0;
}

@media (max-width: 1000px) {
  .promo-body { grid-template-columns: 1fr; }
  .promo-body .score-card.total {
    flex-direction: row;
    justify-content: space-between;
    min-width: auto;
  }
}

@media (max-width: 600px) {
  .promo-body .score-card.total {
    flex-direction: column;
    align-items: center;
  }
}

.promo-card .score-card {
  background: var(--color-bg-action);
  border: 1px solid var(--color-border-muted);
  border-top: 1px solid var(--color-highlight-2);
  border-radius: var(--radius-md);
  padding: 0.875rem 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.promo-card .score-card.total {
  align-items: center;
  justify-content: center;
  min-width: 110px;
  padding: 1rem 1.5rem;
}

.score-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.score-card-title {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.score-card-value {
  font-size: 0.95rem;
  font-weight: 700;
}

.promo-card .score-track {
  height: 6px;
  background: var(--color-bg-base);
  border-radius: 3px;
  overflow: hidden;
}

.promo-card .score-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.3s ease;
}

.score-grid {
  display: grid;
  gap: 0.375rem 0.75rem;
  margin-top: 0.25rem;
}

.score-grid.quality { grid-template-columns: repeat(2, 1fr); }
.score-grid.meta    { grid-template-columns: repeat(3, 1fr); }

.score-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.75rem;
  padding: 0.25rem 0;
  border-bottom: 1px solid var(--color-border-muted);
}

.score-item:last-child { border-bottom: none; }
.score-label { color: var(--color-text-muted); }

.score-val {
  font-weight: 500;
  color: var(--color-text-secondary);
}

.total-label {
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.total-value {
  font-size: 2.5rem;
  font-weight: 700;
  line-height: 1;
}

.promo-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 1rem;
  border-top: 1px solid var(--color-border-muted);
  flex-wrap: wrap;
  gap: 0.75rem;
}

.promo-meta {
  display: flex;
  gap: 1.5rem;
  font-size: 0.8rem;
  flex-wrap: wrap;
}

.promo-meta .meta-item { display: flex; gap: 0.35rem; }
.promo-meta .meta-label { color: var(--color-text-muted); }
.promo-meta .meta-val { color: var(--color-text-secondary); font-weight: 500; }

.promo-actions {
  display: flex;
  gap: 0.5rem;
}

.promo-card .status-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  padding: 0.25rem 0.6rem;
  border-radius: var(--radius-md);
  font-size: 0.7rem;
  font-weight: 500;
}

.promo-card .status-pill.status-enabled {
  background: var(--color-success-glow);
  color: var(--color-success-text);
}

.promo-card .status-pill.status-disabled {
  background: var(--color-bg-base);
  color: var(--color-text-muted);
}

.promo-card .status-pill .status-icon { width: 12px; height: 12px; }

.promo-card .sev-pill {
  padding: 0.2rem 0.6rem;
  border-radius: var(--radius-md);
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
}

.promo-card .mitre-pill {
  padding: 0.2rem 0.6rem;
  border-radius: var(--radius-md);
  font-size: 0.7rem;
  font-weight: 500;
  font-family: monospace;
}

.promo-card .mitre-pill.mitre-neutral {
  background: var(--color-info-glow);
  color: var(--color-info-text);
}

.promo-card .mitre-pill.mitre-more {
  background: var(--color-bg-base);
  color: var(--color-text-muted);
}


/* ================================================================
 * BUTTONS  (Layer 3 — bg-action)
 * ================================================================ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  font: var(--p);
  font-size: 0.875rem;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all var(--transition-fast);
  box-shadow: var(--shadow-sm);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-2);
  background: var(--color-bg-action);
  color: var(--color-text);
}

.btn:hover {
  background: var(--color-bg-action-hover);
  box-shadow: var(--shadow);
}

.btn:focus { outline: none; }

.btn-primary {
  background: var(--color-primary);
  color: var(--color-bg-base);
  border: none;
  border-top: 1px solid var(--color-primary-hover);
}

.btn-primary:hover { background: var(--color-primary-hover); }

.btn-secondary {
  background: var(--color-bg-action);
  color: var(--color-text);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-2);
}

.btn-secondary:hover {
  background: var(--color-bg-action-hover);
  border-color: var(--color-border-strong);
}

.btn-sm { padding: 0.35rem 0.75rem; font-size: 0.75rem; }
.btn-block { width: 100%; }

.btn-validate {
  background: var(--color-bg-action);
  color: var(--color-text-secondary);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-2);
}

.btn-validate:hover {
  background: var(--color-success-bg);
  color: var(--color-success-text);
  border-color: var(--color-success);
}

.btn-logic {
  background: var(--color-bg-action);
  color: var(--color-text-secondary);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-2);
}

.btn-logic:hover {
  background: var(--color-info-bg);
  color: var(--color-info-text);
  border-color: var(--color-info);
}

/* HTMX button states */
.htmx-indicator { display: none; }
.htmx-request .htmx-indicator { display: inline-flex; align-items: center; gap: 0.5rem; }
.htmx-request .btn-text { display: none; }

.sync-btn .htmx-indicator { display: none; }
.sync-btn .sync-default { display: inline-flex; align-items: center; gap: 0.5rem; }
.sync-btn.htmx-request .htmx-indicator { display: inline-flex; align-items: center; gap: 0.5rem; }
.sync-btn.htmx-request .sync-default { display: none; }
.sync-btn.htmx-request .htmx-indicator svg { animation: spin 1s linear infinite; }


/* ================================================================
 * FORMS  (Layer 3 — bg-action)
 * ================================================================ */
.form-input {
  width: 100%;
  padding: 0.5rem 0.75rem;
  font: var(--p);
  font-size: 0.875rem;
  background: var(--color-bg-action);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-2);
  border-radius: var(--radius-md);
  color: var(--color-text);
  transition: all var(--transition-fast);
  box-shadow: var(--shadow-sm);
}

.form-input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 2px var(--color-primary-muted);
}

.form-input::placeholder { color: var(--color-text-muted); }

.form-select {
  width: 100%;
  height: 38px;
  padding: 0.5rem 0.75rem;
  font: var(--p);
  font-size: 0.875rem;
  background-color: var(--color-bg-action);
  border: 1px solid var(--color-border);
  border-top: 1px solid var(--color-highlight-2);
  border-radius: var(--radius-md);
  color: var(--color-text);
  transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
  box-shadow: var(--shadow-sm);
  cursor: pointer;
}

.form-select:hover { border-color: var(--color-border-strong); }

.form-select:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 2px var(--color-primary-muted);
}

.form-select option {
  background: var(--color-bg-surface);
  color: var(--color-text);
}

.form-label {
  display: block;
  font: var(--small);
  font-weight: 500;
  color: var(--color-text-secondary);
  margin-bottom: 0.35rem;
}


/* ================================================================
 * HEATMAP / MATRIX
 * ================================================================ */
.matrix-container {
  display: grid;
  gap: 0.5rem;
  overflow-x: auto;
  padding-bottom: 1rem;
}

.tactic-column {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  min-width: 100px;
  align-self: start;
}

.tactic-header {
  font-size: 0.6rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.03em;
  color: var(--color-text-muted);
  padding: 0.5rem 0.25rem;
  background-color: var(--color-bg-surface);
  border-radius: var(--radius-sm);
  text-align: center;
  position: sticky;
  top: 0;
  z-index: 10;
  height: 3.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 1.2;
  word-break: break-word;
  hyphens: auto;
}

.ttp-card {
  font-size: 0.7rem;
  font-weight: 500;
  padding: 0.375rem 0.5rem;
  border-radius: var(--radius-sm);
  border: 1px solid transparent;
  cursor: pointer;
  transition: all var(--transition-fast);
  text-align: center;
  white-space: nowrap;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
}

.ttp-card:hover {
  transform: scale(1.05);
  z-index: 10;
}

.ttp-id { /* Technique ID text */ }

.ttp-rule-count {
  font-size: 0.6rem;
  font-weight: 600;
  opacity: 0.8;
}

/* Heatmap status colors (hex replacements for OKLCH) */
.status-gap {
  background-color: #3d1f1f;
  border-color: #6e3630;
  color: #d4807a;
}

.status-gap:hover {
  background-color: #4a2622;
  transform: scale(1.02);
  box-shadow: 0 2px 8px rgba(110,54,48,0.3);
}

.status-covered {
  background-color: #1a3224;
  border-color: #2b5a3a;
  color: #7cc48d;
}

.status-covered:hover {
  background-color: #213d2c;
  transform: scale(1.02);
  box-shadow: 0 2px 8px rgba(43,90,58,0.3);
}

.status-defense {
  background-color: #1a2332;
  border-color: #2a4a6e;
  color: #7ab0d4;
}

.status-defense:hover {
  background-color: #1f2b3d;
  transform: scale(1.02);
  box-shadow: 0 2px 8px rgba(42,74,110,0.3);
}


/* ================================================================
 * GRID LAYOUTS
 * ================================================================ */
.metrics-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 1rem;
  margin-bottom: 1.5rem;
}

@media (max-width: 1200px) { .metrics-grid { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 768px)  { .metrics-grid { grid-template-columns: repeat(2, 1fr); } }

.rules-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

@media (max-width: 1200px) { .rules-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 768px)  { .rules-grid { grid-template-columns: 1fr; } }


/* ================================================================
 * THREAT CARDS
 * ================================================================ */
.threats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

@media (max-width: 1200px) { .threats-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 768px)  { .threats-grid { grid-template-columns: 1fr; } }

.threat-card {
  background: var(--color-bg-surface);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  transition: all var(--transition-fast);
  box-shadow: var(--shadow);
}

.threat-card:hover {
  background: var(--color-bg-surface-hover);
  border-color: var(--color-border-strong);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.threat-card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 0.5rem;
}

.threat-card-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex: 1;
  min-width: 0;
}

.actor-flag { font-size: 1.25rem; flex-shrink: 0; }

.actor-name {
  font: var(--h4);
  color: var(--color-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin: 0;
}

.fully-covered-badge { flex-shrink: 0; }

.threat-card-sources {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
}

.source-pill {
  font-size: 0.7rem;
  padding: 0.15rem 0.5rem;
  background: var(--color-bg-action);
  border: 1px solid var(--color-border-muted);
  border-radius: var(--radius-md);
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.025em;
}

.source-pill.src-enterprise { background: var(--color-info-glow);    border-color: var(--color-info);    color: var(--color-info-text); }
.source-pill.src-ics        { background: var(--color-warning-glow); border-color: var(--color-warning); color: var(--color-warning-text); }
.source-pill.src-mobile     { background: var(--color-primary-muted); border-color: var(--color-primary); color: var(--color-primary); }
.source-pill.src-pre        { background: var(--color-danger-glow);  border-color: var(--color-danger);  color: var(--color-danger-text); }
.source-pill.src-opencti    { background: var(--color-success-glow); border-color: var(--color-success); color: var(--color-success-text); }

.threat-card-aliases {
  font: var(--small);
  color: var(--color-text-secondary);
  margin: 0;
  font-style: italic;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.threat-card-desc {
  font: var(--small);
  color: var(--color-text-muted);
  margin: 0;
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Coverage bars */
.coverage-section { margin-top: auto; }

.coverage-meta {
  display: flex;
  justify-content: space-between;
  font: var(--small);
  color: var(--color-text-muted);
  margin-bottom: 0.25rem;
}

.progress-track {
  height: 6px;
  background: var(--color-bg-base);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  border-radius: var(--radius-full);
  transition: width var(--transition-normal);
}

.progress-good { background-color: var(--color-sev-4); }
.progress-warn { background-color: var(--color-sev-2); }
.progress-bad  { background-color: var(--color-sev-1); }

/* TTP Expander */
.ttp-expander {
  border-top: 1px solid var(--color-border-muted);
  padding-top: 0.75rem;
  margin-top: 0.5rem;
}

.ttp-summary {
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  font: var(--small);
  color: var(--color-text-secondary);
  padding: 0.25rem 0;
}

.ttp-summary:hover { color: var(--color-text); }
.ttp-summary::-webkit-details-marker { display: none; }
.ttp-summary { list-style: none; }

.expand-icon {
  transition: transform var(--transition-fast);
  font-size: 0.75rem;
}

.ttp-expander[open] .expand-icon { transform: rotate(180deg); }

.ttp-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 1rem;
  padding-top: 0.75rem;
  border-top: 1px solid var(--color-border-muted);
  max-height: 200px;
  overflow-y: auto;
}

.ttp-tag {
  font-size: 0.7rem;
  padding: 0.2rem 0.5rem;
  border-radius: var(--radius-md);
  font-family: "SF Mono", "Fira Code", monospace;
  white-space: nowrap;
  cursor: pointer;
  transition: all var(--transition-fast);
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
}

.ttp-tag:hover { transform: scale(1.05); z-index: 10; }

.ttp-covered {
  background: var(--color-covered-glow);
  color: var(--color-success-text);
  border: 1px solid var(--color-covered);
  box-shadow: 0 0 8px var(--color-covered-glow);
}

.ttp-covered:hover {
  box-shadow: 0 0 12px var(--color-covered-glow), 0 2px 8px rgba(43,90,58,0.3);
}

.ttp-gap {
  background: var(--color-gap-glow);
  color: var(--color-danger-text);
  border: 1px solid var(--color-gap);
  box-shadow: 0 0 8px var(--color-gap-glow);
}

.ttp-gap:hover {
  box-shadow: 0 0 12px var(--color-gap-glow), 0 2px 8px rgba(110,54,48,0.3);
}

.ttp-rule-count {
  font-size: 0.6rem;
  font-weight: 600;
  opacity: 0.8;
}

/* TTP list scrollbar */
.ttp-list::-webkit-scrollbar { width: 4px; }
.ttp-list::-webkit-scrollbar-track { background: var(--color-bg-surface); border-radius: 2px; }
.ttp-list::-webkit-scrollbar-thumb { background: var(--color-border); border-radius: 2px; }

.ttp-expander[open] {
  position: relative;
  z-index: 10;
  background: var(--color-bg-surface);
  margin: 0.75rem -1rem -1rem -1rem;
  padding: 0.5rem 1rem 1rem 1rem;
  border-radius: 0 0 var(--radius-md) var(--radius-md);
  border-top: 1px solid var(--color-border-muted);
  box-shadow: 0 4px 16px rgba(0,0,0,0.3);
}


/* ================================================================
 * CSS TOOLTIPS  (data-tooltip) — Layer 5
 * ================================================================ */
[data-tooltip] { position: relative; }

[data-tooltip]:not(.nav-item)::before,
[data-tooltip]:not(.nav-item)::after {
  position: absolute;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: all var(--transition-fast);
  z-index: 100;
}

[data-tooltip]:not(.nav-item)::before {
  content: attr(data-tooltip);
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%) translateY(4px);
  padding: 0.4rem 0.6rem;
  background: var(--color-bg-layer-5);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-size: 0.7rem;
  font-weight: 500;
  color: var(--color-text);
  white-space: nowrap;
  box-shadow: var(--shadow-lg);
}

[data-tooltip]:not(.nav-item)::after {
  content: '';
  bottom: calc(100% + 2px);
  left: 50%;
  transform: translateX(-50%) translateY(4px);
  border: 6px solid transparent;
  border-top-color: var(--color-bg-layer-5);
}

[data-tooltip]:not(.nav-item):hover::before,
[data-tooltip]:not(.nav-item):hover::after {
  opacity: 1;
  visibility: visible;
  transform: translateX(-50%) translateY(0);
}

/* Actor flags */
.actor-flag-icon {
  width: 20px;
  height: 15px;
  border-radius: 2px;
  margin-right: 0.5rem;
  flex-shrink: 0;
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1);
}

.actor-flag-placeholder {
  width: 20px;
  height: 15px;
  margin-right: 0.5rem;
  flex-shrink: 0;
}

.threat-aliases {
  font: var(--small);
  color: var(--color-text-muted);
  margin-bottom: 0.75rem;
  font-style: italic;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.expand-chevron {
  width: 14px;
  height: 14px;
  opacity: 0.7;
  transition: transform var(--transition-fast);
  transform: rotate(90deg);
}

.ttp-expander[open] .expand-chevron { transform: rotate(-90deg); }

.empty-state-icon {
  width: 48px;
  height: 48px;
  opacity: 0.5;
  margin: 0 auto 1rem;
}


/* ================================================================
 * THREAT CARD LAYOUT EXTRAS
 * ================================================================ */
.threat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.threat-header-left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex: 1;
  min-width: 0;
}

.source-pills {
  display: flex;
  flex-wrap: nowrap;
  gap: 0.15rem;
  flex-shrink: 0;
}

.threat-desc {
  font: var(--small);
  color: var(--color-text-secondary);
  line-height: 1.5;
  flex: 1;
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 4;
  line-clamp: 4;
  -webkit-box-orient: vertical;
  margin-bottom: 0.75rem;
}

.threat-coverage { margin-top: auto; }

.coverage-value { font-weight: 600; }

.coverage-track {
  height: 5px;
  background: var(--color-bg-base);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.coverage-fill {
  height: 100%;
  border-radius: var(--radius-full);
  transition: width var(--transition-normal);
}
.coverage-fill.fill-success { background-color: var(--color-success); }
.coverage-fill.fill-warning { background-color: var(--color-warning); }
.coverage-fill.fill-danger  { background-color: var(--color-danger); }

.status-icon {
  width: 11px;
  height: 11px;
  flex-shrink: 0;
}


/* ================================================================
 * PAGE HEADER
 * ================================================================ */
.page-header { margin-bottom: 1.5rem; }

.header-centered {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.header-centered .page-subtitle {
  margin-left: auto;
  margin-right: auto;
  max-width: 700px;
}

.page-title {
  font: var(--h1);
  color: var(--color-text);
  margin-bottom: 0.25rem;
}

.page-subtitle {
  font: var(--p);
  color: var(--color-text-muted);
}


/* ================================================================
 * FILTERS BAR  (Layer 2 — bg-surface)
 * ================================================================ */
.filters-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: flex-end;
  padding: 1rem;
  background: var(--color-bg-surface);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow);
}

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.filter-group.grow {
  flex: 1;
  min-width: 200px;
}


/* ================================================================
 * PAGINATION
 * ================================================================ */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin-top: 1.5rem;
  padding-top: 1rem;
  border-top: var(--border-card);
}

.pagination-info {
  color: var(--color-text-muted);
  font: var(--small);
}


/* ================================================================
 * HTMX INDICATORS
 * ================================================================ */
.htmx-indicator {
  opacity: 0;
  transition: opacity var(--transition-fast);
}

.htmx-request .htmx-indicator,
.htmx-request.htmx-indicator { opacity: 1; }

.loading-spinner {
  display: inline-block;
  width: 1rem;
  height: 1rem;
  border: 2px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* HTMX body-level loading */
.htmx-request { cursor: wait; }
.htmx-request .main-content {
  opacity: 0.7;
  pointer-events: none;
  transition: opacity var(--transition-fast);
}


/* ================================================================
 * TOAST NOTIFICATIONS
 * ================================================================ */
.toast-container {
  position: fixed;
  bottom: 1rem;
  right: 1rem;
  z-index: 100;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.toast {
  padding: 0.75rem 1rem;
  border-radius: var(--radius-md);
  font: var(--small);
  box-shadow: var(--shadow-lg);
  animation: slideIn var(--transition-normal);
}

.toast-success {
  background: var(--color-success-bg);
  border: 1px solid var(--color-success);
  color: var(--color-success-text);
}

.toast-error {
  background: var(--color-danger-bg);
  border: 1px solid var(--color-danger);
  color: var(--color-danger-text);
}

.toast.show { opacity: 1; transform: translateX(0); }
.toast-warning { border-left: 3px solid var(--color-warning); }
.toast-info    { border-left: 3px solid var(--color-info); }


/* ================================================================
 * DIVIDER
 * ================================================================ */
.divider {
  height: 1px;
  background: var(--color-border);
  margin: 1.5rem 0;
}


/* ================================================================
 * EMPTY STATE
 * ================================================================ */
.empty-state {
  text-align: center;
  padding: 3rem 1rem;
  color: var(--color-text-muted);
}

.empty-state-icon { font-size: 3rem; margin-bottom: 1rem; }

.empty-state-title {
  font: var(--h3);
  color: var(--color-text-secondary);
  margin-bottom: 0.5rem;
}

.empty-state p {
  max-width: 300px;
  margin: 0 auto;
}

.empty-rules {
  text-align: center;
  padding: 2rem;
  color: var(--color-text-muted);
  font-size: 0.875rem;
}


/* ================================================================
 * LIGHT MODE
 * ================================================================ */
body.light {
  --color-bg-base:         #f6f8fa;
  --color-bg-base-alt:     #eef1f5;
  --color-bg-surface:      #ffffff;
  --color-bg-surface-hover:#f6f8fa;
  --color-bg-action:       #ffffff;
  --color-bg-action-hover: #f6f8fa;
  --color-bg-layer-4:      #ffffff;
  --color-bg-layer-4-hover:#f6f8fa;
  --color-bg-layer-5:      #ffffff;
  --color-bg-layer-5-hover:#f6f8fa;

  --color-highlight-1: #ffffff;
  --color-highlight-2: #ffffff;
  --color-highlight-3: #ffffff;

  --color-text:           #1f2328;
  --color-text-secondary: #424a53;
  --color-text-muted:     #656d76;

  --color-border:       #d0d7de;
  --color-border-muted: #e6e8eb;
  --border-card: solid 1px var(--color-border-muted);

  --color-primary:       #0969da;
  --color-primary-hover: #0550ae;
  --color-secondary:     #bf5a2d;

  --color-sev-1:     #cf222e;
  --color-sev-2:     #9a6700;
  --color-sev-3:     #0969da;
  --color-sev-4:     #1a7f37;
  --color-sev-5:     #8250df;

  --color-sev-1-bg:  #ffebe9;
  --color-sev-2-bg:  #fff8c5;
  --color-sev-3-bg:  #ddf4ff;
  --color-sev-4-bg:  #dafbe1;
  --color-sev-5-bg:  #fbefff;
}


/* ================================================================
 * ICON UTILITIES
 * ================================================================ */
.icon {
  display: inline-block;
  vertical-align: middle;
  flex-shrink: 0;
}

.icon.spin { animation: spin 1s linear infinite; }

.text-success { color: var(--color-success); }
.text-warning { color: var(--color-warning); }
.text-danger  { color: var(--color-danger); }
.text-info    { color: var(--color-info); }
.text-muted   { color: var(--color-text-muted); }
.text-primary { color: var(--color-primary); }
.text-secondary { color: var(--color-text-secondary); }


/* ================================================================
 * USER MENU DROPDOWN  (Layer 4)
 * ================================================================ */
.user-menu-container { position: relative; }

.user-menu {
  position: absolute;
  bottom: 100%;
  left: 0;
  right: 0;
  background: var(--color-bg-layer-4);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  padding: 0.5rem;
  margin-bottom: 0.5rem;
  display: none;
  z-index: 200;
  min-width: 180px;
}

.user-menu.show { display: block; }

.user-menu-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 0.75rem;
  border-radius: var(--radius-sm);
  color: var(--color-text-secondary);
  font-size: 0.875rem;
  cursor: pointer;
  transition: all var(--transition-fast);
  text-decoration: none;
  border: none;
  background: transparent;
  width: 100%;
  text-align: left;
}

.user-menu-item:hover {
  background: var(--color-bg-action);
  color: var(--color-text);
}

.user-menu-item svg {
  width: 18px;
  height: 18px;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
}

.user-menu-divider {
  height: 1px;
  background: var(--color-border-muted);
  margin: 0.5rem 0;
}


/* ================================================================
 * PAGE TITLE HERO  (common h1 pattern)
 * ================================================================ */
.page-title-hero {
  font-size: 2.5rem;
  color: var(--color-primary);
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.section-title {
  font-size: 0.9rem;
  color: var(--color-primary);
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}


/* ================================================================
 * MODULE GRID & CARDS  (Dashboard / Home)
 * ================================================================ */
.module-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
}

.module-card {
  background: var(--color-bg-action);
  border: none;
  border-top: 1px solid var(--color-highlight-2);
  border-radius: var(--radius-md);
  padding: 1rem;
  transition: all var(--transition-fast);
  text-decoration: none;
  display: block;
  box-shadow: var(--shadow-sm);
}

.module-card:hover {
  background: var(--color-bg-action-hover);
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.module-title {
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--color-text);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.module-title svg { color: var(--color-primary); }

.module-desc {
  font-size: 0.75rem;
  color: var(--color-text-muted);
  line-height: 1.5;
}


/* ================================================================
 * OVERVIEW SECTION  (Home page)
 * ================================================================ */
.overview-section {
  background: var(--color-bg-surface);
  border: none;
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
  box-shadow: var(--shadow);
}

.overview-section h2 {
  font-size: 1.1rem;
  color: var(--color-primary);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.tech-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 0.75rem;
}

.tech-item {
  background: var(--color-bg-action);
  border: none;
  border-top: 1px solid var(--color-highlight-2);
  border-radius: var(--radius-md);
  padding: 0.75rem;
  text-align: center;
  box-shadow: var(--shadow-sm);
}

.tech-item svg { color: var(--color-primary); margin-bottom: 0.25rem; }

.tech-item-name {
  font-weight: 600;
  font-size: 0.8rem;
  color: var(--color-text);
}

.tech-item-desc {
  font-size: 0.7rem;
  color: var(--color-text-muted);
  margin-top: 0.15rem;
}

/* Design principle items (Home page) */
.principle-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.principle-card {
  display: flex;
  gap: 0.75rem;
  align-items: flex-start;
  background: var(--color-bg-action);
  border: none;
  border-top: 1px solid var(--color-highlight-2);
  border-radius: var(--radius-md);
  padding: 1rem;
  box-shadow: var(--shadow-sm);
  transition: all var(--transition-fast);
}

.principle-card strong { color: var(--color-text); }

.principle-card p {
  font-size: 0.8rem;
  color: var(--color-text-muted);
  margin: 0;
}

/* Legacy principle-item (keep for compat) */
.principle-item {
  display: flex;
  gap: 0.75rem;
  align-items: flex-start;
}

.principle-item strong { color: var(--color-text); }

.principle-item p {
  font-size: 0.8rem;
  color: var(--color-text-muted);
}


/* ================================================================
 * DASHBOARD INTEGRATIONS GRID
 * ================================================================ */
.dashboard-integrations-grid .overview-section {
  margin-bottom: 0;
}

.integration-card {
  background: var(--color-bg-action);
  border: none;
  border-top: 1px solid var(--color-highlight-2);
  border-radius: var(--radius-md);
  padding: 1rem;
  text-align: center;
  transition: all var(--transition-fast);
  box-shadow: var(--shadow-sm);
  display: flex;
  flex-direction: column;
  justify-content: center;
  min-height: 90px;
  min-width: 0;
  overflow: hidden;
}

.integration-card .integration-card-name {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: 0.15rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.integration-card .integration-card-url {
  font-size: 0.65rem;
  color: var(--color-text-muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: 0.5rem;
}

.integration-card .integration-card-status {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  font-size: 0.7rem;
  font-weight: 500;
}

.integration-card .integration-card-status::before {
  content: '';
  width: 7px;
  height: 7px;
  border-radius: 50%;
  flex-shrink: 0;
}

.integration-card .integration-card-status.status-active {
  color: #3fb950;
}

.integration-card .integration-card-status.status-active::before {
  background: #3fb950;
  box-shadow: 0 0 6px rgba(63,185,80,0.5);
}

.integration-card .integration-card-status.status-inactive {
  color: var(--color-text-muted);
}

.integration-card .integration-card-status.status-inactive::before {
  background: var(--color-text-muted);
}


/* ================================================================
 * INTEGRATION ROWS  (Dashboard & Settings)
 * ================================================================ */
.integrations-grid {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.integration-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem 1rem;
  background: var(--color-bg-action);
  border: none;
  border-top: 1px solid var(--color-highlight-2);
  border-radius: var(--radius-md);
  overflow: hidden;
  max-width: 100%;
  min-width: 0;
}

.integration-info {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
  min-width: 0;
  flex: 1;
  overflow: hidden;
}

.integration-info .preference-desc {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Status indicator dots */
.status-active {
  color: #3fb950;
}

.status-active::before {
  background: #3fb950;
  box-shadow: 0 0 6px rgba(63,185,80,0.5);
}

.status-inactive {
  color: var(--color-text-muted);
}

.status-inactive::before {
  background: var(--color-text-muted);
}


/* ================================================================
 * LOGIN PAGE
 * ================================================================ */
.login-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  background: var(--color-bg-base);
}

.login-card {
  background: var(--color-bg-surface);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-xl);
  padding: 3rem;
  text-align: center;
  max-width: 400px;
  width: 100%;
  box-shadow: var(--shadow-lg);
}

.login-logo {
  margin-bottom: 1.5rem;
  display: flex;
  justify-content: center;
}

.login-logo img { border-radius: var(--radius-lg); }

.login-title {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--color-text);
  margin-bottom: 0.5rem;
}

.login-subtitle {
  font-size: 0.9rem;
  color: var(--color-text-muted);
  margin-bottom: 2rem;
}

.login-description {
  font-size: 0.95rem;
  color: var(--color-text-secondary);
  margin-bottom: 2rem;
  line-height: 1.6;
}

.btn-login {
  width: 100%;
  padding: 0.875rem 1.5rem;
  font-size: 1rem;
  justify-content: center;
}

.login-footer {
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border-muted);
  color: var(--color-text-muted);
  font-size: 0.8rem;
}

.auth-disabled-notice {
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: var(--color-warning-bg);
  border-radius: var(--radius-md);
  color: var(--color-warning-text);
}

.login-page .sidebar { display: none !important; }
.login-page .main-content { margin-left: 0 !important; }


/* ================================================================
 * PREFERENCES PAGE
 * ================================================================ */
.preferences-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 1.5rem;
}

.preference-card {
  background: var(--gradient);
  border: var(--border-card);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  box-shadow: var(--shadow);
}

.preference-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--color-border-muted);
}

.preference-icon {
  width: 24px;
  height: 24px;
  stroke: var(--color-primary);
  fill: none;
  stroke-width: 2;
}

.preference-title {
  font: var(--h3);
  color: var(--color-text);
  margin: 0;
}

.preference-body {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.preference-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  overflow: hidden;
}

.preference-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  min-width: 0;
  flex: 1;
}

.preference-label {
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--color-text);
  white-space: nowrap;
}

.preference-item .form-select {
  min-width: 100px;
  max-width: 140px;
}

.preference-desc {
  font-size: 0.8125rem;
  color: var(--color-text-muted);
}

.theme-toggle-group {
  display: flex;
  gap: 0.5rem;
}

.theme-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-bg-action);
  color: var(--color-text-secondary);
  font-size: 0.875rem;
  cursor: pointer;
  transition: all var(--transition-fast);
}

.theme-btn:hover {
  border-color: var(--color-primary);
  color: var(--color-text);
}

.theme-btn.active {
  background: var(--color-primary-muted);
  border-color: var(--color-primary);
  color: var(--color-primary);
}

.theme-btn svg {
  width: 18px;
  height: 18px;
  stroke: currentColor;
  fill: none;
  stroke-width: 2;
}

.hue-picker {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.hue-slider {
  width: 120px;
  height: 8px;
  -webkit-appearance: none;
  appearance: none;
  background: linear-gradient(to right,
    hsl(0, 70%, 50%), hsl(60, 70%, 50%), hsl(120, 70%, 50%),
    hsl(180, 70%, 50%), hsl(240, 70%, 50%), hsl(300, 70%, 50%), hsl(360, 70%, 50%)
  );
  border-radius: 4px;
  outline: none;
}

.hue-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: white;
  border: 2px solid var(--color-border);
  cursor: pointer;
  box-shadow: var(--shadow);
}

.hue-value {
  font-size: 0.875rem;
  color: var(--color-text-muted);
  min-width: 30px;
}

.toggle-switch {
  position: relative;
  width: 48px;
  height: 24px;
  flex-shrink: 0;
}

.toggle-switch input { opacity: 0; width: 0; height: 0; }

.toggle-slider {
  position: absolute;
  cursor: pointer;
  inset: 0;
  background-color: var(--color-bg-action);
  border-radius: 24px;
  transition: 0.2s;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: var(--color-text-muted);
  border-radius: 50%;
  transition: 0.2s;
}

.toggle-switch input:checked + .toggle-slider {
  background-color: var(--color-primary-muted);
}

.toggle-switch input:checked + .toggle-slider:before {
  transform: translateX(24px);
  background-color: var(--color-primary);
}


/* ================================================================
 * MODAL OVERLAY/CONTENT  (Layer 5)
 * ================================================================ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: var(--color-overlay);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  padding: 1rem;
  animation: fadeIn 0.2s ease-out;
}

.modal-content {
  background: var(--color-bg-surface);
  border: 1px solid var(--color-border);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  width: 100%;
  max-width: 800px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: var(--shadow-modal);
  animation: slideUp 0.2s ease-out;
}

.modal-content.modal-sm { max-width: 500px; }

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
}

.modal-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
}

.modal-section {
  margin-bottom: 1.5rem;
}

.modal-section-title {
  font-size: 0.9rem;
  color: var(--color-text-muted);
  margin-bottom: 0.5rem;
}

/* Query display block */
.query-display {
  background: var(--color-bg-base);
  padding: 1rem;
  border-radius: var(--radius-md);
  font-size: 0.8rem;
  line-height: 1.6;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-wrap: break-word;
  max-height: 300px;
  overflow-y: auto;
  color: var(--color-text-secondary);
}

.query-display .hl-kw    { color: var(--color-warning); font-weight: 600; }
.query-display .hl-str   { color: var(--color-success); }
.query-display .hl-field { color: var(--color-info); }
.query-display .hl-op    { color: var(--color-text-muted); }

.modal-section-subtitle {
  font-size: 0.9rem;
  color: var(--color-text-muted);
  margin-bottom: 0.75rem;
}

/* Modal metric grids */
.modal-metric-grid {
  display: grid;
  gap: 0.75rem;
}
.modal-metric-grid-4 { grid-template-columns: repeat(4, 1fr); }
.modal-metric-grid-6 { grid-template-columns: repeat(6, 1fr); gap: 0.5rem; }

/* Standalone metric compact cards (for modals) */
.metric-compact {
  background: var(--color-bg-surface);
  border: var(--border-card);
  border-radius: var(--radius-md);
  padding: 0.75rem;
  text-align: center;
}
.metric-compact-sm {
  background: var(--color-bg-surface);
  border: var(--border-card);
  border-radius: var(--radius-md);
  padding: 0.5rem;
  text-align: center;
}
.metric-compact-value {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
}
.metric-compact-sm .metric-compact-value {
  font-size: 1rem;
}
.metric-compact-label {
  font-size: 0.75rem;
  color: var(--color-text-muted);
}
.metric-compact-sm .metric-compact-label {
  font-size: 0.7rem;
}

/* Modal action row */
.modal-actions {
  display: flex;
  gap: 0.75rem;
  justify-content: flex-end;
}

/* Mapping table wrapper */
.mapping-table-wrapper {
  max-height: 200px;
  overflow-y: auto;
}

.mapping-table {
  width: 100%;
  font-size: 0.8rem;
  border-collapse: collapse;
}

.mapping-table th,
.mapping-table td {
  padding: 0.5rem;
  border-bottom: 1px solid var(--color-border-muted);
  text-align: left;
}

.mapping-table th {
  background: var(--color-bg-base);
  border-bottom-color: var(--color-border);
}

.mapping-table .text-center { text-align: center; }

/* Alert banners */
.alert {
  padding: 0.5rem 0.75rem;
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
}

.alert-success {
  background: var(--color-success-bg);
  color: var(--color-success-text);
  border: 1px solid var(--color-success);
}

.alert-danger {
  background: var(--color-danger-bg);
  color: var(--color-danger-text);
  border: 1px solid var(--color-danger);
}

.alert-warning {
  background: var(--color-warning-bg);
  color: var(--color-warning-text);
  border: 1px solid var(--color-warning);
}

.alert-info {
  background: var(--color-info-bg);
  color: var(--color-info-text);
  border: 1px solid var(--color-info);
}

/* Score fill color variants */
.score-fill.fill-success { background-color: var(--color-success); }
.score-fill.fill-warning { background-color: var(--color-warning); }
.score-fill.fill-danger  { background-color: var(--color-danger); }

/* Metric card compact variants for modals */
.metric-card.metric-compact    { padding: 0.75rem; }
.metric-card.metric-compact-sm { padding: 0.5rem; }

.metric-card.metric-compact .metric-value,
.metric-card.metric-compact-sm .metric-value { font-size: 1.25rem; }

.metric-card.metric-compact-sm .metric-value { font-size: 1rem; }
.metric-card.metric-compact-sm .metric-label { font-size: 0.7rem; }


/* ================================================================
 * SIGMA PAGE
 * ================================================================ */
.sigma-header-row {
  display: flex;
  gap: 1rem;
  align-items: flex-end;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
}

.sigma-select-group {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.sigma-select-group label {
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--color-primary);
  letter-spacing: 0.05em;
}

.sigma-select {
  min-width: 140px;
  padding: 0.4rem 0.6rem;
  font-size: 0.8rem;
  background: var(--color-bg-action);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text);
  cursor: pointer;
}

.sigma-select:hover { border-color: var(--color-border-strong); }
.sigma-select:focus { outline: none; border-color: var(--color-primary); }

.sigma-main {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  height: calc(100vh - 280px);
  min-height: 500px;
  max-height: 700px;
}

@media (max-width: 900px) {
  .sigma-main { grid-template-columns: 1fr; height: auto; max-height: none; }
}

.sigma-panel {
  background: var(--color-bg-surface);
  border: 1px solid var(--color-border);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-lg);
  padding: 1rem;
  display: flex;
  flex-direction: column;
  height: 100%;
  box-shadow: var(--shadow);
}

.sigma-panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--color-text);
  padding-bottom: 0.5rem;
  flex-shrink: 0;
}

.sigma-panel-header .header-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sigma-panel-header .header-info {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  font-size: 0.7rem;
  font-weight: 400;
  color: var(--color-info-text);
  background: var(--color-info-bg);
  border: 1px solid var(--color-info);
  border-radius: var(--radius-sm);
  padding: 0.25rem 0.6rem;
}

.sigma-panel-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-height: 0;
}

.code-editor-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.CodeMirror {
  flex: 1 !important;
  height: auto !important;
  min-height: 280px !important;
  background: var(--color-bg-base) !important;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: 0.75rem;
  line-height: 1.5;
}

.CodeMirror-focused { border-color: var(--color-primary) !important; }
.CodeMirror-gutters { background: var(--color-bg-base) !important; border-right: 1px solid var(--color-border-muted) !important; }
.CodeMirror-linenumber { color: var(--color-text-muted) !important; }

#query-output-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.query-output-box {
  flex: 1;
  background: var(--color-bg-base);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  overflow: auto;
  min-height: 280px;
}

.query-output-box pre {
  margin: 0;
  padding: 0.75rem;
  white-space: pre-wrap !important;
  word-wrap: break-word !important;
  word-break: break-word !important;
  overflow-wrap: break-word !important;
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: 0.75rem;
  line-height: 1.5;
  color: var(--color-text);
  background: transparent !important;
}

.query-output-box pre code,
.query-output-box code[class*="language-"],
.query-output-box pre[class*="language-"] {
  background: transparent !important;
  font-size: inherit;
  font-family: inherit;
  white-space: pre-wrap !important;
  word-wrap: break-word !important;
  display: block;
  text-shadow: none;
}

.empty-output {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  min-height: 200px;
  color: var(--color-text-muted);
  text-align: center;
  gap: 0.5rem;
  padding: 1rem;
}

.sigma-panel-footer {
  flex-shrink: 0;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
  gap: 0.75rem;
  padding-top: 0.75rem;
  margin-top: auto;
  min-height: 48px;
}

.sigma-panel-footer.footer-right { justify-content: flex-end; }

.sigma-panel-footer .btn { flex-shrink: 0; height: 32px; }

.sigma-panel-footer .filter-group {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.5rem;
}

.sigma-panel-footer .filter-group label {
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--color-text-muted);
  white-space: nowrap;
}

.sigma-panel-footer .filter-group select {
  width: 120px;
  height: 32px;
  padding: 0 0.5rem;
  font-size: 0.75rem;
  background: var(--color-bg-action);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text);
}

.sigma-panel-footer .filter-group select option {
  background: var(--color-bg-action);
  color: var(--color-text);
}

.sigma-panel-footer .checkbox-group {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  font-size: 0.75rem;
  color: var(--color-text);
  height: 32px;
}

#validation-result { margin-top: 0.5rem; }

/* Sigma form body (flex column fill) */
.sigma-form-body {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
}

/* Sigma deploy form (inline row) */
.sigma-deploy-form {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 0.75rem;
  width: 100%;
  justify-content: flex-end;
}

.info-banner {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  background: var(--color-info-bg);
  border: 1px solid var(--color-info);
  border-radius: var(--radius-sm);
  margin-bottom: 0.5rem;
  font-size: 0.7rem;
  color: var(--color-info-text);
}


/* ================================================================
 * RULE BROWSER  (Sigma page)
 * ================================================================ */
.rule-browser {
  background: var(--color-bg-surface);
  border: 1px solid var(--color-border);
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-md);
  margin-bottom: 1rem;
  box-shadow: var(--shadow-sm);
}

.rule-browser-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  cursor: pointer;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--color-text);
}

.rule-browser-header:hover { background: var(--color-bg-action); }

.rule-browser-content {
  padding: 0 1rem 1rem;
  display: none;
}

.rule-browser.open .rule-browser-content { display: block; }

.rule-browser-chevron { transition: transform var(--transition-fast); }
.rule-browser.open .rule-browser-chevron { transform: rotate(180deg); }

.browser-filters {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  flex-wrap: wrap;
}

.browser-filter {
  flex: 1;
  min-width: 120px;
}

.browser-filter label {
  display: block;
  font-size: 0.65rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--color-text-muted);
  margin-bottom: 0.25rem;
}

.browser-filter input,
.browser-filter select {
  width: 100%;
  padding: 0.35rem 0.5rem;
  font-size: 0.75rem;
  background: var(--color-bg-action);
  border: 1px solid var(--color-border-muted);
  border-radius: var(--radius-sm);
  color: var(--color-text);
}

.browser-filter input:focus,
.browser-filter select:focus {
  outline: none;
  border-color: var(--color-primary);
}

.rules-list-container {
  max-height: 180px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.rule-item-btn {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.4rem 0.6rem;
  background: var(--color-bg-action);
  border: none;
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-sm);
  cursor: pointer;
  text-align: left;
  transition: all var(--transition-fast);
  width: 100%;
  font-size: 0.75rem;
}

.rule-item-btn:hover { background: var(--color-bg-action-hover); }

.rule-item-title {
  color: var(--color-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1;
}

.rule-item-meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0;
  font-size: 0.65rem;
  color: var(--color-text-muted);
}

.level-badge {
  font-size: 0.55rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.1rem 0.3rem;
  border-radius: var(--radius-sm);
}

.level-critical      { background: var(--color-sev-1-bg); color: var(--color-sev-1-text); }
.level-high          { background: var(--color-sev-2-bg); color: var(--color-sev-2-text); }
.level-medium        { background: var(--color-sev-3-bg); color: var(--color-sev-3-text); }
.level-low           { background: var(--color-sev-4-bg); color: var(--color-sev-4-text); }
.level-informational { background: var(--color-sev-5-bg); color: var(--color-sev-5-text); }

.rules-count {
  font-size: 0.7rem;
  color: var(--color-text-muted);
  margin-bottom: 0.5rem;
}


/* ================================================================
 * ACTOR SELECT  (Heatmap page)
 * ================================================================ */
.actor-select-container {
  position: relative;
  width: 100%;
}

.actor-select-trigger {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  background: var(--color-bg-action);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  cursor: pointer;
  min-height: 38px;
}

.actor-select-trigger:hover {
  border-color: var(--color-border-strong);
}

.actor-select-text {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.actor-select-text.has-selection {
  color: var(--color-text);
}

.actor-select-chevron {
  width: 16px;
  height: 16px;
  color: var(--color-text-muted);
  transition: transform 0.15s ease;
  flex-shrink: 0;
}

.actor-select-container.open .actor-select-chevron {
  transform: rotate(180deg);
}

.actor-select-dropdown {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  right: 0;
  background: var(--color-bg-layer-5);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  z-index: 100;
  display: none !important;
  flex-direction: column;
  max-height: 300px;
  overflow: hidden;
}

.actor-select-container.open .actor-select-dropdown {
  display: flex !important;
}

.actor-search-input {
  width: 100%;
  padding: 0.5rem 0.75rem;
  background: var(--color-bg-action);
  border: none;
  border-bottom: 1px solid var(--color-border);
  color: var(--color-text);
  font-size: 0.875rem;
}

.actor-search-input:focus {
  outline: none;
  background: var(--color-bg-action-hover);
}

.actor-checkbox-list {
  display: flex;
  flex-direction: column;
  max-height: 250px;
  overflow-y: auto;
  padding: 0.25rem;
}

.actor-checkbox-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.75rem;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.15s ease;
}

.actor-checkbox-item:hover {
  background: var(--color-bg-action);
}

.actor-checkbox-item input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: var(--color-primary);
  flex-shrink: 0;
}

.actor-checkbox-label {
  flex: 1;
  font-size: 0.85rem;
  color: var(--color-text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.actor-checkbox-count {
  font-size: 0.7rem;
  color: var(--color-text-muted);
  flex-shrink: 0;
}


/* ================================================================
 * SLIDE-OVER PANEL  (Heatmap technique detail)
 * ================================================================ */
.slide-panel-overlay {
  position: fixed;
  inset: 0;
  background-color: rgba(0,0,0,0.7);
  z-index: 100;
  display: flex;
  justify-content: flex-end;
  animation: fadeIn 0.2s ease-out;
}

.slide-panel {
  width: 100%;
  max-width: 480px;
  height: 100vh;
  background-color: var(--color-bg-surface);
  border-left: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  animation: slideInPanel 0.3s ease-out;
}

@keyframes slideInPanel {
  from { transform: translateX(100%); }
  to   { transform: translateX(0); }
}

.slide-panel-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  padding: 1.5rem;
  border-bottom: 1px solid var(--color-border);
}

.technique-id {
  display: inline-block;
  background-color: var(--color-primary-muted);
  color: var(--color-primary);
  font-size: 0.75rem;
  font-weight: 600;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  margin-bottom: 0.5rem;
}

.technique-name {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
  margin: 0;
  line-height: 1.3;
}

.btn-icon {
  background: none;
  border: none;
  color: var(--color-text-muted);
  cursor: pointer;
  padding: 0.5rem;
  border-radius: var(--radius-sm);
  transition: all var(--transition-fast);
}

.btn-icon:hover {
  background-color: var(--color-bg-action);
  color: var(--color-text);
}

.slide-panel-content {
  flex: 1;
  overflow-y: auto;
  padding: 1.5rem;
}

/* Technique status */
.technique-status {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  border-radius: var(--radius-md);
  font-size: 0.875rem;
  font-weight: 500;
  margin-bottom: 1.5rem;
}

.technique-status.status-covered {
  background-color: #1a3224;
  color: #7ee787;
}

.technique-status.status-gap {
  background-color: #3d1f1f;
  color: #ffa198;
}

/* Technique metadata */
.technique-meta {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.technique-meta .meta-item {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.technique-meta .meta-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted);
}

.meta-value {
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.external-link {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 2rem;
}

/* ── Technique detail action buttons ── */
.technique-actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
}

/* Rules section in slide panel */
.rules-section {
  padding-top: 1rem;
}

.rules-title {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: 1rem;
}

.rules-title-filter {
  font-weight: normal;
  font-size: 0.75rem;
}

.rules-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.rule-item {
  background-color: var(--color-bg-action);
  border: none;
  border-top: 1px solid var(--color-highlight-1);
  border-radius: var(--radius-md);
  padding: 1rem;
}

.rule-item .rule-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.rule-item .rule-name {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--color-text);
  line-height: 1.3;
}

.severity-badge {
  font-size: 0.625rem;
  font-weight: 600;
  text-transform: uppercase;
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  white-space: nowrap;
}

/* Severity badge hex conversions from heatmap.css OKLCH */
.severity-critical {
  background-color: #3d1f1f;
  color: #e08080;
}

.severity-high {
  background-color: #3d2e00;
  color: #e0b040;
}

.severity-medium {
  background-color: #2e2e10;
  color: #d4c870;
}

.severity-low {
  background-color: #1a3224;
  color: #70c480;
}

.rule-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  font-size: 0.75rem;
  color: var(--color-text-muted);
}

.rule-meta > span {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.rule-score {
  color: #d4a850;
}

.rule-status.enabled {
  color: #58c06a;
}

.rule-status.disabled {
  color: #c06050;
}

.rule-mitre-ids {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
  margin-top: 0.75rem;
}

.mitre-tag {
  font-size: 0.625rem;
  background-color: var(--color-bg-action);
  color: var(--color-text-muted);
  padding: 0.125rem 0.375rem;
  border-radius: var(--radius-sm);
}


/* ================================================================
 * GAP RECOMMENDATIONS
 * ================================================================ */
.gap-recommendations {
  border-top: 1px solid var(--color-border);
  padding-top: 1.5rem;
}

.recommendations-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.recommendations-list li {
  position: relative;
  padding-left: 1.5rem;
  padding-bottom: 0.75rem;
  font-size: 0.875rem;
  color: var(--color-text-secondary);
}

.recommendations-list li::before {
  content: "\2192";
  position: absolute;
  left: 0;
  color: var(--color-primary);
}


/* ================================================================
 * HEATMAP LEGEND
 * ================================================================ */
.heatmap-legend {
  display: flex;
  gap: 1.5rem;
  margin-top: 1rem;
  justify-content: center;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.legend-swatch {
  padding: 0.25rem 0.5rem;
  cursor: default;
}

.legend-label {
  font-size: 0.8rem;
  color: var(--color-text-muted);
}


/* ================================================================
 * SETTINGS PAGE  (migrated from inline <style>)
 * ================================================================ */

/* Settings tab navigation */
.settings-tabs {
  display: flex;
  gap: 0.25rem;
  margin-bottom: 1.5rem;
  border-bottom: 1px solid var(--color-border-muted);
  padding-bottom: 0;
}

.settings-tab {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.25rem;
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--color-text-muted);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition-fast);
  margin-bottom: -1px;
}

.settings-tab:hover {
  color: var(--color-text);
  background: var(--color-bg-surface);
  border-radius: var(--radius-md) var(--radius-md) 0 0;
}

.settings-tab.active {
  color: var(--color-primary);
  border-bottom-color: var(--color-primary);
}

.settings-tab svg {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

/* Tab panels */
.settings-panel {
  display: none;
}

.settings-panel.active {
  display: block;
}

/* Fix grid overflow for all cards */
.settings-panel .preference-card {
  min-width: 0;
  overflow: hidden;
}

/* Action bar */
.settings-actions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border-muted);
}

.settings-actions .btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

/* Settings-specific form input overrides */
.settings-panel .form-input {
  width: 250px;
}

.settings-panel .form-input[type="number"] {
  width: 80px;
  text-align: center;
}

.settings-panel .form-input[type="time"] {
  width: 120px;
}

/* Code preview */
.code-preview {
  background: var(--color-bg-base);
  border: 1px solid var(--color-border-muted);
  border-radius: var(--radius-md);
  padding: 1rem;
  font-family: 'JetBrains Mono', 'Fira Code', monospace;
  font-size: 0.7rem;
  line-height: 1.4;
  color: var(--color-text-secondary);
  white-space: pre;
  overflow: hidden;
}

/* JSON syntax highlighting (hex replacements for OKLCH) */
.json-key   { color: #58a6ff; }
.json-string { color: #d4a050; }
.json-num   { color: #7ee787; }
.json-bool  { color: #d2a8ff; }
.json-brace { color: var(--color-text-muted); font-weight: 600; }
.json-colon { color: var(--color-text-muted); }


/* ================================================================
 * SYNC TRACKER
 * ================================================================ */
.sync-tracker {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.4rem 0.85rem;
  border-radius: var(--radius-md);
  font-size: 0.8125rem;
  font-weight: 500;
  white-space: nowrap;
  animation: fadeIn 0.2s ease;
}

.sync-running {
  background: #1a2332;
  border: 1px solid #3268a8;
  color: #79c0ff;
}

.sync-complete {
  background: #1a3224;
  border: 1px solid #2b8a3e;
  color: #7ee787;
}

.sync-error {
  background: #3d1f1f;
  border: 1px solid #a83232;
  color: #ffa198;
}

.sync-spinner {
  width: 14px;
  height: 14px;
  border: 2px solid #3268a8;
  border-top-color: #79c0ff;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}


/* ================================================================
 * UTILITY SPACING
 * ================================================================ */
.mb-0   { margin-bottom: 0; }
.mb-sm  { margin-bottom: 0.5rem; }
.mb-md  { margin-bottom: 1rem; }
.mb-lg  { margin-bottom: 1.5rem; }
.mb-xl  { margin-bottom: 2rem; }
.mt-md  { margin-top: 1rem; }
.mt-lg  { margin-top: 1.5rem; }
.mt-xl  { margin-top: 2rem; }

.text-center { text-align: center; }
.text-sm { font-size: 0.8rem; }
.p-md    { padding: 1rem; }
.grow    { flex: 1; }

/* Severity text colors for metrics */
.text-sev-medium { color: #d4c870; }


/* ================================================================
 * FOOTER BAR
 * ================================================================ */
.footer-bar {
  text-align: center;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--color-border);
}


/* ================================================================
 * LOADING SPINNER (heatmap variant)
 * ================================================================ */
.loading-spinner.heatmap-spinner {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.75rem;
  padding: 2rem;
  color: var(--color-text-muted);
  animation: none;
}

.spinner {
  width: 24px;
  height: 24px;
  border: 2px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}


/* ================================================================
 * KEYFRAMES
 * ================================================================ */
@keyframes spin {
  to { transform: rotate(360deg); }
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(1rem); }
  to   { opacity: 1; transform: translateX(0); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}
